<div class="w-100"
     *ngIf="control">
  <div class="form-label-group position-relative"
       [class.invalid]="control.touched && control.invalid">
    <span *ngIf="required && !readonly"
          class="required-indicator h-100">
    </span>

    <a *ngIf="!readonly"
       class="form-control typeahead-form-control d-flex flex-row flex-wrap"
       [class.has-focus]="hasFocus()"
       [class.placeholder-shown]="showPlaceholder()"
       (click)="inputField?.focus()">

      <fieldset>
        <legend class="sr-only">Selected Items</legend>
        <div class="badge typeahead-badge"
             *ngFor="let item of selectedItems; let i = index"
             [ngClass]="getItemClass(item)">
          {{item.label}}
          <button class="remove-button ml-1"
                  (click)="removeItem(item)"
                  [attr.aria-label]="'Remove Item ' + item.label">
            <i class="fa fa-times"></i>
          </button>
          <!-- a11y
          <input class="sr-only"
                 [attr.id]="id + '-selected-' + i"
                 type="checkbox"
                 tabindex="-1"
                 checked/>
          <label class="sr-only"
                 [for]="id + '-selected-' + i">
            {{item.label}}
          </label>
          -->
        </div>

      </fieldset>
      <input #inputField
          [attr.id]="id"
          [attr.required]="required"
          [attr.aria-required]="!!required"
          [attr.aria-describedby]="validationId + ' ' + helpId"
          [ngbTypeahead]="wrappedItemLoaderFn"
          [resultFormatter]="formatResultItem"
          [container]="'body'"
          [resultTemplate]="template"
          [focusFirst]="focusFirst"
          [style.width]="getInputWidth()"
          [editable]="editable"
          [readonly]="limit && selectedItems.length >= limit"
          [(ngModel)]="inputValue"
          (selectItem)="selectItem($event)"
          (blur)="control.markAsTouched()">
    </a>
    <label [for]="id" class="d-flex">
     {{label}}
      <span class="flex-grow-1"></span>
      <span *ngIf="limit && selectedItems.length">
        {{selectedItems.length + '/' + limit}}
        <span class="sr-only">Items</span>
      </span>
    </label>

    <div *ngIf="readonly"
         [class.placeholder-shown]="!control.value"
         class="readonly-input">
      {{control.value}}
    </div>

    <!-- a11y -->
   <div class="sr-only" [attr.id]="helpId">
     <ng-container *ngIf="limit && selectedItems.length >= limit; else helpText">
       Limit of {{ limit }} reached. Press Shift + Tab to delete selected items.
     </ng-container>
     <ng-template #helpText>
       Enter  {{ TYPEAHEAD_QUERY_MIN_LENGTH }}
     </ng-template>
   </div>

   <ng-template #template
                let-result="result"
                let-term="term"
                let-formatter="formatter">
     <div class="position-relative">
       <div *ngIf="result.firstInGroup"
            class="typeahead-group-label pull-right"
            [ngClass]="getTypeClass(result.model)">
         <!--{{'typeahead-multiselect.type.' + result.model.type }}-->
          {{ result.model.type }}
        </div>
        <div [ngClass]="{'first-in-group-item': result.firstInGroup}">
          <div class="first-in-group-border"
               *ngIf="result.firstInGroup"></div>
          <ngb-highlight [result]="formatResultItem(result.model)"
                         [term]="term"></ngb-highlight>
        </div>
      </div>

    </ng-template>

  </div>
  <alv-validation-messages *ngIf="!readonly"
                           [control]="control"
                           [id]="validationId"
                           [customValidationMessages]="validationMessages">
  </alv-validation-messages>
</div>
