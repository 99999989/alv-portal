<div class="container-fluid pt-2 pt-lg-4">
  <alv-assistant-layout [stickyTop]="layoutConstants.STICKY_TOP_DETAIL">
    <div class="left-column">
      <!--        todo this is a stub. The assistant for all steps needs to be specified and implemented in the future-->
      <a class="btn btn-text btn-text-icon btn-truncate mb-3 d-none d-lg-block d-print-none"
         routerLink="/work-efforts">
        <fa-icon class="mr-1"
                 [icon]="['fas', 'caret-left']"></fa-icon>
        {{'entity.action.back' | translate}}
      </a>
      <alv-assistant-link [isActive]="true"
                          class="d-none d-lg-block d-print-none"
                          [link]="{
          labelKey: 'portal.work-efforts.assistant-label',
          routerLink: '.'
        }">
      </alv-assistant-link>

    </div>
    <div class="main-column">
      <div class="d-block d-lg-none w-100 mb-4"
           ngbDropdown
           placement="bottom">
        <button class="btn btn-secondary btn-block py-1"
                ngbDropdownToggle>
          {{'portal.navigation.menu-entry.work-efforts'|translate}}
        </button>
        <div class="w-100"
             ngbDropdownMenu>
          <button *ngFor="let toolbarButton of [
                    {
                      label: 'entity.action.back',
                      route: 'work-efforts'
                    },
                    {
                      label: 'portal.navigation.menu-entry.work-efforts',
                      route: '.'
                    }
                  ]"
                  [routerLink]="toolbarButton.route"
                  class="dropdown-item"
                  ngbDropdownItem
                  routerLinkActive="active">
            {{toolbarButton.label | translate}}
          </button>
        </div>
      </div>
      <h2>
        <alv-custom-icon class="text-primary"
                         aria-hidden="true"
                         [iconKey]="IconKey.WORK_EFFORTS">
        </alv-custom-icon>
        {{'portal.work-efforts.edit-form.title'|translate}}
      </h2>
      <hr class="mb-4">
      <form (validSubmit)="submit()"
            [formGroup]="workEffortFormGroup"
            class="mb-5"
            alvFormSubmitValidation>
        <!--      Date-->
        <alv-collapse-panel panelTitle="portal.work-efforts.edit-form.application-date-panel-label"
                            [isAlwaysExpanded]="true">
          <div class="alv-light-panel p-2 pb-0 mb-0">
            <alv-date-input alvFormControlName="date"
                            [minDate]="minDate"
                            [maxDate]="maxDate"
                            label="portal.global.date"
                            container="body">
            </alv-date-input>
          </div>
        </alv-collapse-panel>

        <div class="arrow-container pt-0">
          <div class="arrow-down secondary">
          </div>
        </div>

        <!--      Apply channel-->
        <alv-collapse-panel panelTitle="portal.work-efforts.edit-form.way-of-application-panel-label"
                            [isAlwaysExpanded]="true">
          <fieldset formGroupName="applyChannels">
            <div class="alv-light-panel p-2 mb-1"
                 *ngFor="let applyChannelCheckbox of applyChannelsCheckboxNames">
              <alv-checkbox [alvFormControlName]="applyChannelCheckbox"
                            [label]="'portal.work-efforts.edit-form.apply-channel.' + applyChannelCheckbox"
              >
              </alv-checkbox>
            </div>
            <alv-validation-messages id="application-at-least-one-required-msg-id"
                                     [control]="workEffortFormGroup.get('applyChannels')"
                                     [customValidationMessages]="[{
                                        error: 'atLeastOneRequired',
                                        message: 'portal.work-efforts.edit-form.group-errors.at-least-one-apply-channel-required'
                                      }]">
            </alv-validation-messages>
          </fieldset>
        </alv-collapse-panel>

        <div class="arrow-container pt-0">
          <div class="arrow-down secondary">
          </div>
        </div>
        <!--      ADDRESS AND COMPANY DETAILS SECTION -->
        <alv-collapse-panel panelTitle="portal.work-efforts.edit-form.company-panel-label"
                            class="pb-0"
                            [isAlwaysExpanded]="true">
          <alv-input-field [maxLength]="NAME_MAX_LENGTH"
                           alvFormControlName="companyName"
                           label="home.tools.job-publication.company.name">
          </alv-input-field>
          <fieldset formGroupName="companyAddress">
            <div formGroupName="postOfficeBoxNumberOrStreet"
                 class="form-row">
              <alv-input-field [maxLength]="STREET_MAX_LENGTH"
                               [showGroupErrors]="true"
                               [validationMessages]="[{
                                error: 'atLeastOneRequired',
                                message: 'home.tools.job-publication.messages.validate.at-least-one-required-street-or-pobox'
                                }]"
                               alvFormControlName="street"
                               class="col-8"
                               label="home.tools.job-publication.company.street">
              </alv-input-field>
              <alv-input-field [maxLength]="HOUSE_NUMBER_MAX_LENGTH"
                               alvFormControlName="houseNumber"
                               class="col-4"
                               label="home.tools.job-publication.company.house-number">
              </alv-input-field>

              <alv-input-field [maxLength]="PO_BOX_MAX_LENGTH"
                               [showGroupErrors]="true"
                               [validationMessages]="[{
                              error: 'atLeastOneRequired',
                              message: 'home.tools.job-publication.messages.validate.at-least-one-required-street-or-pobox'
                     }]"
                               alvFormControlName="postOfficeBoxNumber"
                               label="home.tools.job-publication.company.postbox-number"
                               class="col-12">
              </alv-input-field>
            </div>

            <alv-select [options$]="countryOptions$"
                        alvFormControlName="countryIsoCode"
                        label="home.tools.job-publication.company.country"></alv-select>

            <alv-zip-city-input [parentForm]="workEffortFormGroup.get('companyAddress')"
                                [zipCityFormValue]="initialZipAndCity"
                                [countryIsoCode]="countryIsoCode$ | async">
            </alv-zip-city-input>

          </fieldset>

          <alv-input-field alvFormControlName="contactPerson"
                           label="portal.work-efforts.edit-form.contact-person">
          </alv-input-field>

          <fieldset formGroupName="companyEmailAndUrl">
            <alv-input-field [showGroupErrors]="true"
                             alvFormControlName="email"
                             [validationMessages]="[{
                                error: 'atLeastOneRequired',
                                message: 'portal.work-efforts.edit-form.group-errors.email-or-url-required'}
                                ]"
                             label="portal.global.email">
            </alv-input-field>
            <alv-input-field [showGroupErrors]="true"
                             alvFormControlName="url"
                             label="portal.work-efforts.edit-form.company.online-form-url"
                             [validationMessages]="[{
                                error: 'atLeastOneRequired',
                                message: 'portal.work-efforts.edit-form.group-errors.email-or-url-required'}
                           ]">
            </alv-input-field>
          </fieldset>

          <alv-input-field [showGroupErrors]="true"
                           class="mb-0"
                           alvFormControlName="phone"
                           label="portal.global.phone"
                           [isRequired]="workEffortFormGroup.get('applyChannels')?.value?.PHONE"
                           placeholder="portal.global.phone-swiss-example"
                           type="tel">
          </alv-input-field>
        </alv-collapse-panel>

        <div class="arrow-container">
          <div class="arrow-down secondary">
          </div>
        </div>

        <!--      Occupation-->
        <alv-collapse-panel panelTitle="portal.work-efforts.edit-form.occupation-panel-label"
                            [isAlwaysExpanded]="true">
          <alv-input-field [showGroupErrors]="true"
                           alvFormControlName="occupation"
                           class="mb-0"
                           label="portal.global.job-title">
          </alv-input-field>
        </alv-collapse-panel>

        <div class="arrow-container">
          <div class="arrow-down secondary">
          </div>
        </div>

        <alv-collapse-panel panelTitle="portal.work-efforts.edit-form.rav-helped-label"
                            [isAlwaysExpanded]="true">
          <div class="alv-light-panel p-2 mb-1">
            <alv-radio-button
              [options$]="appliedThroughRavOptions$"
              alvFormControlName="appliedThroughRav"
              class="narrow-form">
            </alv-radio-button>
          </div>
        </alv-collapse-panel>
        <div class="arrow-container pt-0">
          <div class="arrow-down secondary">
          </div>
        </div>
        <!--      Contract type-->
        <alv-collapse-panel panelTitle="portal.work-efforts.edit-form.work-load-panel-label"
                            [isAlwaysExpanded]="true">
          <div class="alv-light-panel p-2 mb-1">
            <alv-radio-button
              [options$]="workLoadOptions$"
              alvFormControlName="workload"
              class="narrow-form">
            </alv-radio-button>
          </div>
        </alv-collapse-panel>

        <div class="arrow-container pt-0">
          <div class="arrow-down secondary">
          </div>
        </div>
        <!--      Results and rejection reason -->
        <alv-collapse-panel panelTitle="portal.work-efforts.edit-form.result"
                            [isAlwaysExpanded]="true">
          <fieldset formGroupName="results">
            <div *ngFor="let resultCheckbox of resultsCheckboxNames"
                 class="alv-light-panel p-2 mb-1">
              <alv-checkbox
                [alvFormControlName]="resultCheckbox"
                [label]="'portal.work-efforts.edit-form.results.' + resultCheckbox"
                class="narrow-form">
              </alv-checkbox>
            </div>
            <alv-validation-messages [control]="workEffortFormGroup.get('results')"
                                     [customValidationMessages]="[{
                                        error: 'atLeastOneRequired',
                                        message: 'portal.work-efforts.edit-form.group-errors.at-least-one-result-required'
                                      }]">
            </alv-validation-messages>
          </fieldset>
          <ng-container *ngIf="workEffortFormGroup?.get('results')?.get('REJECTED')?.value">
            <div class="arrow-container">
              <div class="arrow-down">
              </div>
            </div>
            <alv-input-field [isRequired]="workEffortFormGroup?.get('results')?.get('REJECTED')?.value"
                             alvFormControlName="rejectionReason"
                             label="portal.work-efforts.edit-form.rejection-reason">
            </alv-input-field>
          </ng-container>
        </alv-collapse-panel>
        <alv-alert [hideDismiss]="true"
                   [notification]="bottomAlert"></alv-alert>
        <div class="d-flex justify-content-end">
          <button (click)="goToWorkEffortsList()"
                  class="btn btn-text">{{'portal.global.cancel' | translate}}</button>
          <button type="submit"
                  class="btn btn-primary">{{'entity.action.save' | translate}}</button>
        </div>
      </form>
    </div>

    <div class="right-column">
      <alv-link-panel [linkPanelId]="LinkPanelId.WORK_EFFORT_EDIT"
                      class="info-panel"
                      [numberOfColumns]="1">
      </alv-link-panel>
    </div>
  </alv-assistant-layout>
</div>
