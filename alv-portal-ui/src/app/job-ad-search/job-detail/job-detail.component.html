<div class="container-fluid">
  <alv-three-column-layout *ngIf="jobDetailModel$ | async as jobDetailModel"
                           [mobileOrdering]="[2, 1, null]">
    <ng-container class="mobile-menu-bar">
      <div class="d-flex justify-content-between">
        <div>
          <a class="btn btn-text btn-text-icon mb-2"
             routerLink="/job-search">
            <i class="fa fa-caret-left mr-1"></i>
            {{'job-detail.back' | translate}}
          </a>
        </div>
        <div #mobileActionsMenu="ngbDropdown"
             class="d-inline-block"
             ngbDropdown
             placement="bottom-right">
          <button (click)="mobileActionsMenu.toggle()"
                  class="btn btn-text btn-icon"
                  id="dropdownMenu"
                  ngbDropdownAnchor
                  aria-label="Open job detail menu">
            <i class="fa fa-ellipsis-v"></i>
          </button>
          <div aria-label="Job detail menu"
               ngbDropdownMenu>
            <button (click)="prev()"
                    [disabled]="!(prevEnabled$ | async)"
                    class="dropdown-item">
              {{'portal.job-detail.previous-result' | translate}}
            </button>
            <button (click)="next()"
                    [disabled]="!(nextEnabled$ | async)"
                    class="dropdown-item">
              {{'portal.job-detail.next-result' | translate}}
            </button>
            <a *ngIf="jobDetailModel.applyChannel?.formUrl"
               class="dropdown-item"
               [href]="jobDetailModel.applyChannel?.formUrl"
               target="_blank">
              {{'job-detail.action.applyNow' | translate}}
            </a>
            <a *ngIf="jobDetailModel.jobContent.externalUrl"
               class="dropdown-item"
               [href]="jobDetailModel.jobContent.externalUrl"
               target="_blank}">
              {{'job-detail.action.showExternalPage' | translate}}
            </a>
            <button (click)="printJob()"
                    class="dropdown-item">
              <span>{{'job-detail.action.print' | translate}}</span>
            </button>
            <a class="dropdown-item"
               [href]="'mailto:?body=' + getEncodedUrl()">
              <span>{{'job-detail.action.sendEmail' | translate}}</span>
            </a>
          </div>
        </div>
      </div>
    </ng-container>

    <ng-container class="left-column">
      <a class="btn btn-text btn-text-icon btn-truncate mb-3 d-none d-md-block d-print-none"
         routerLink="/job-search">
        <i class="fa fa-caret-left pr-1"></i>
        {{'job-detail.back' | translate}}
      </a>
      <div class="alv-panel p-2 mb-3">
        <div class="d-flex d-sm-block flex-column-reverse">

          <div class="company-panel">
            <div *ngIf="jobDetailModel.jobContent.company as company">
              <alv-post-address [address]="company">
              </alv-post-address>
            </div>

            <div *ngIf="!jobDetailModel.publication.companyAnonymous && jobDetailModel.jobContent.publicContact as contact">
              <strong>{{'job-detail.contactPerson' | translate}}</strong>
              <br>
              <span *ngIf="contact.salutation">{{ 'global.contactPerson.salutation.' + contact.salutation | translate }}</span>
              {{ contact.firstName }}&nbsp;{{ contact.lastName }}
              <br>

              <ng-container *ngIf="contact.phone">
                <a class="link"
                   href="tel:{{contact.phone}}">
                  {{ contact.phone | phoneNumber }}
                </a>
                <br>
              </ng-container>

              <a *ngIf="contact.email"
                 class="link"
                 style="max-width: 100%"
                 href="mailto:{{ contact.email }}">
                {{ contact.email }}
              </a>
            </div>
          </div>

          <div *ngIf="jobDetailModel.stellennummerAvam && jobDetailModel.jobCenter as jobCenter"
               class="order-sm-2 alv-logo-box">


            <div *ngIf="jobCenter.address as address">
              <strong>
                {{ 'portal.job-detail.reference.responsible-job-center' | translate }}
              </strong>
              <alv-post-address [address]="{
                        name: address.name,
                        street: address.street,
                        houseNumber: address.houseNumber,
                        postalCode: address.zipCode,
                        city: address.city}">
              </alv-post-address>
              <br>
              {{'portal.job-detail.reference.phone' | translate}}
              <a class="link"
                 href="tel:{{jobCenter.phone}}">{{jobCenter.phone | phoneNumber}}</a>
            </div>

            <ng-container *ngIf="jobDetailModel.stellennummerAvam || jobDetailModel.stellennummerEgov">
              <strong>{{'portal.job-detail.reference.job-id' | translate}}:</strong>
              <br>

              <ng-container *ngIf="jobDetailModel.stellennummerAvam">
                {{'job-detail.avam.label' | translate}}
                : {{jobDetailModel.stellennummerAvam}}
                <br>
              </ng-container>

              <ng-container *ngIf="jobDetailModel.stellennummerEgov">
                {{'job-detail.job-room-id' | translate}} {{jobDetailModel.stellennummerEgov}}
              </ng-container>
            </ng-container>
          </div>

        </div>
      </div>
    </ng-container>

    <ng-container class="main-column"
                  *ngIf="jobDetailModel.jobDescription as jobDescription">
      <!-----------------Alerts-->
      <div *ngIf="(alerts$ | async) as alerts">
        <alv-alert *ngFor="let alert of alerts"
                   [notification]="alert"
                   (dismiss)="dismissAlert(alert, alerts)">
        </alv-alert>
        <div *ngIf="alerts.length"
             class="mb-4">
        </div>
      </div>
      <!-----------------Title-->

      <h2 class="mb-4"
          [innerHTML]="jobDescription.title | safeHtml"></h2>
      <span class="job-company mr-2 mr-md-4"
            *ngIf="jobDetailModel.jobContent.company; else ravLabel">{{jobDetailModel.jobContent.company.name}}</span>
      <ng-template #ravLabel>
        {{ 'jobroomApp.job.rav' | translate }}
      </ng-template>
      <small class="mr-2 mr-md-4"
             *ngIf="jobDetailModel.publication.startDate">
        {{'job-detail.onlineSince' | translate}}
        : {{ jobDetailModel.publication.startDate | localeAwareDate }}
      </small>
      <small *ngIf="jobDetailModel.jobContent.numberOfJobs">
        {{'jobroomApp.job.numberOfJobs' | translate}}
        : {{ jobDetailModel.jobContent.numberOfJobs }}
      </small>

      <!--Badges-->
      <div class="mb-4">
        <alv-inline-badges [badges]="badges$|async"></alv-inline-badges>
      </div>

      <!-----------------Description-->

      <div *ngIf="jobDescription.description">
        <markdown [data]="jobDescription.description"
                  ngPreserveWhitespaces>
        </markdown>
      </div>

      <!-----------------Bottom details about job-->

      <div class="mb-3">
        <alv-collapse-panel [panelId]="jobDetailPanelId.JOB_AD_INFO"
                            panelTitle="portal.job-detail.jobad-info.label">
          <ul class="alv-list">
            <alv-list-item-content label="portal.job-detail.workplace.label">
              {{jobDetailModel.jobContent.location | jobLocation}}
            </alv-list-item-content>

            <alv-list-item-content *ngIf="jobDetailModel.hasStartDate()"
                                   label="portal.job-detail.employmentStartDate.label">
              {{jobDetailModel.employment.startDate | localeAwareDate}}
            </alv-list-item-content>

            <alv-list-item-content *ngIf="jobDetailModel.hasImmediately()"
                                   label="portal.job-detail.employmentStartDate.label">
              {{'job-detail.startsImmediately.' + jobDetailModel.employment.immediately | translate}}
            </alv-list-item-content>

            <alv-list-item-content label="portal.job-detail.workload.label">
              {{[jobDetailModel.employment?.workloadPercentageMin, jobDetailModel.employment?.workloadPercentageMax] | workingTimeRange}}
            </alv-list-item-content>

            <alv-list-item-content *ngIf="jobDetailModel.isTemporary()"
                                   label="portal.job-detail.employmentEndDate.label">
              {{'job-search.job-search-list-item.badge.temporary' | translate}}
            </alv-list-item-content>

            <alv-list-item-content *ngIf="jobDetailModel.isPermanent()"
                                   label="portal.job-detail.employmentEndDate.label">
              {{'job-search.job-search-list-item.badge.permanent' | translate}}
            </alv-list-item-content>

            <alv-list-item-content *ngIf="jobDetailModel.isShortEmployment()"
                                   label="portal.job-detail.workForm.label">
              {{'job-search.job-search-list-item.badge.shortEmployment' | translate}}
            </alv-list-item-content>
          </ul>
        </alv-collapse-panel>

        <alv-collapse-panel *ngIf="jobDetailModel.firstOccupation as occupation"
                            [panelId]="jobDetailPanelId.JOB_AD_REQUIREMENTS"
                            panelTitle="portal.job-detail.min-requirements.label">
          <ul class="alv-list">
            <alv-list-item-content label="portal.job-detail.workExperience">
              {{'global.experience.' + occupation.workExperience | translate}}
            </alv-list-item-content>

            <alv-list-item-content label="portal.job-detail.education">
              {{'global.degree.avamCode.' + occupation.educationCode| translate}}
            </alv-list-item-content>
          </ul>
        </alv-collapse-panel>

        <alv-collapse-panel *ngIf="jobDetailModel.jobContent.languageSkills?.length"
                            [panelId]="jobDetailPanelId.JOB_AD_LANGUAGES"
                            panelTitle="global.reference.languages">
          <alv-language-skills [languages]="jobDetailModel.jobContent.languageSkills">
          </alv-language-skills>
        </alv-collapse-panel>

        <alv-collapse-panel *ngIf="jobDetailModel.applyChannel as applyChannel"
                            [panelId]="jobDetailPanelId.JOB_AD_CONTACT_DETAILS"
                            panelTitle="portal.job-detail.contact-details.label">
          <ul class="alv-list">
            <alv-list-item-content *ngIf="applyChannel.formUrl as formUrl"
                                   label="job-detail.application.online">
              <a class="link"
                 [attr.href]="formUrl | normalizeUrl">
                <i class="fas fa-caret-right link-icon"></i>
                {{ 'job-publication-details.application.online-form' | translate}}
              </a>
            </alv-list-item-content>

            <alv-list-item-content *ngIf="applyChannel.emailAddress as emailAddress"
                                   label="job-detail.application.email">
              <a class="link"
                 href="mailto:{{emailAddress}}">
                <i class="fas fa-caret-right link-icon"></i>
                {{emailAddress}}
              </a>
            </alv-list-item-content>

            <alv-list-item-content *ngIf="applyChannel.phoneNumber as phoneNumber"
                                   label="job-detail.application.phone">
              <a class="link"
                 href="tel:{{phoneNumber}}">
                <i class="fas fa-caret-right link-icon"></i>
                {{(phoneNumber) | phoneNumber}}
              </a>
            </alv-list-item-content>

            <alv-list-item-content *ngIf="applyChannel.postAddress || applyChannel.rawPostAddress"
                                   label="job-detail.application.mail">
              <ng-container *ngIf="applyChannel.postAddress; else rawPostAddress">
                <alv-post-address [address]="applyChannel.postAddress">
                </alv-post-address>
              </ng-container>
              <ng-template #rawPostAddress>
                {{applyChannel.rawPostAddress}}
              </ng-template>
            </alv-list-item-content>
          </ul>
        </alv-collapse-panel>
      </div>
    </ng-container>

    <ng-container class="right-column">
      <div class="d-flex">
        <button (click)="prev()"
                [disabled]="!(prevEnabled$ | async)"
                class="btn btn-text btn-text-icon btn-truncate mb-2">
          <i class="fa fa-caret-left mr-1"></i>
          {{'portal.job-detail.previous-result' | translate}}
        </button>
        <div class="flex-grow-1"></div>
        <button (click)="next()"
                [disabled]="!(nextEnabled$ | async)"
                class="btn btn-text btn-text-icon btn-truncate mb-2">
          {{'portal.job-detail.next-result' | translate}}
          <i class="fa fa-caret-right ml-1"></i>
        </button>
      </div>

      <p>
        <a *ngIf="jobDetailModel.applyChannel?.formUrl"
           class="btn btn-primary btn-block btn-sm mb-1"
           [href]="jobDetailModel.applyChannel?.formUrl | normalizeUrl"
           target="_blank">
          {{'job-detail.action.applyNow' | translate}}
        </a>
        <a *ngIf="jobDetailModel.jobContent.externalUrl"
           class="btn btn-secondary btn-truncate btn-sm"
           [href]="jobDetailModel.jobContent.externalUrl | normalizeUrl"
           [target]="jobDetailModel.id">
          {{'job-detail.action.showExternalPage' | translate}}
        </a>
      </p>

      <ul class="nav flex-column">
        <li>
          <button class="btn btn-text btn-text-icon btn-truncate"
                  ngxClipboard
                  [cbContent]="getJobUrl()"
                  (cbOnSuccess)="onCopyLink()"
                  [ngbTooltip]="'global.messages.tooltip.link-copy.success' | translate"
                  triggers="manual">
            <i aria-hidden="true"
               class="fa fa-copy mr-1"></i>
            {{'job-detail.action.copyLink' | translate}}
          </button>
        </li>
        <li>
          <a class="btn btn-text btn-text-icon btn-truncate"
             [href]="'mailto:?body=' + getEncodedUrl()">
            <i aria-hidden="true"
               class="fa fa-share mr-1"></i>
            {{'job-detail.action.sendEmail' | translate}}
          </a>
        </li>
        <li class="d-none d-md-block">
          <button class="btn btn-text btn-text-icon btn-truncate"
                  (click)="printJob()">
            <i aria-hidden="true"
               class="fa fa-print mr-1"></i>
            {{'job-detail.action.print' | translate}}
          </button>
        </li>
      </ul>
    </ng-container>
  </alv-three-column-layout>
</div>



