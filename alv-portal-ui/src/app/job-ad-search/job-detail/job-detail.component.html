<div class="container mt-md-5">
  <div class="row base"
       *ngIf="job$ | async as job">
    <!--Mobile only - back button and dropdown menu-->
    <div class="d-flex justify-content-between d-md-none">
      <div>
        <a class="btn btn-text"
           routerLink="/job-search">
          <i class="fa fa-caret-left pr-1"></i>
          {{'job-detail.back' | translate}}
        </a>
      </div>
      <div #myDrop="ngbDropdown"
           class="d-inline-block"
           ngbDropdown
           placement="left-top">
        <button (focus)="myDrop.open()"
                class="btn btn-outline-primary mr-2"
                id="dropdownMenu"
                ngbDropdownAnchor>
          <i class="fa fa-ellipsis-v"></i>
        </button>
        <div aria-labelledby="dropdownMenu"
             ngbDropdownMenu>
          <a *ngIf="job.jobContent.applyChannel?.formUrl"
             class="dropdown-item"
             href="{{job.jobContent.applyChannel?.formUrl}}"
             target="{{job.id}}">
            {{'job-detail.action.applyNow' | translate}}
          </a>
          <a *ngIf="job.jobContent.externalUrl"
             class="dropdown-item"
             href="{{job.jobContent.externalUrl}}"
             target="{{job.id}}">
            {{'job-detail.action.showExternalPage' | translate}}
          </a>
          <button (click)="prev()"
                  *ngIf="prevVisible$ | async"
                  class="dropdown-item">
            {{'job-detail.previous-result' | translate}}
          </button>
          <button (click)="next()"
                  *ngIf="nextVisible$ | async"
                  class="dropdown-item">
            {{'job-detail.next-result' | translate}}
          </button>
          <button (click)="printJob()"
                  class="dropdown-item">
            <span>{{'job-detail.action.print' | translate}}</span>
          </button>
          <a class="dropdown-item"
             href="{{'mailto:?body=' + getEncodedUrl()}}">
            <span>{{'job-detail.action.sendEmail' | translate}}</span>
          </a>
        </div>
      </div>
    </div>
    <!-------------Left panel-->
    <div class="col-12 col-md order-11 order-md-1 base__subnavbar">
      <a class="btn btn-text"
         routerLink="/job-search">
        <i class="fa fa-caret-left pr-1"></i>
        {{'job-detail.back' | translate}}
      </a>
      <div class="alv-panel p-2">
        <div class="d-flex d-sm-block flex-column-reverse">

          <hr class="visible-print-block d-none"/>

          <div class="alv-logo-box logo-box logo-box__company flex-height md-whiteframe-1dp">
            <div *ngIf="job.jobContent.company as company"
                 class="detail__content">
              <address>
                <strong>{{ company.name }}</strong>
                <br>

                {{ company.street }} {{ company.houseNumber }}
                <br>

                {{ company.postalCode }} {{ company.city }}
              </address>
            </div>

            <div *ngIf="!job.publication.companyAnonymous && job.jobContent.publicContact as contact">
              <div class="detail__content">
                <strong>{{'job-detail.contactPerson' | translate}}</strong>
                <br>
                <span *ngIf="contact.salutation">{{ 'global.contactPerson.salutation.' + contact.salutation | translate }}</span>
                {{ contact.firstName }}&nbsp;{{ contact.lastName }}
                <br>

                <ng-container *ngIf="contact.phone">
                  <a href="tel:{{contact.phone}}">
                    {{ contact.phone | jr2PhoneNumber }}
                  </a>
                  <br>
                </ng-container>

                <a *ngIf="contact.email"
                   href="mailto:{{ contact.email }}">
                  {{ contact.email }}
                </a>
              </div>
            </div>
          </div>

          <div *ngIf="job.stellennummerAvam && jobCenter$ | async as jobCenter"
               class="order-sm-2 alv-logo-box logo-box logo-box__company flex-height md-whiteframe-1dp">

            <div class="detail__content">
              <address *ngIf="jobCenter.address">
                <strong>{{ 'job-detail.reference.responsible-job-center' | translate }}</strong>
                <br>
                {{jobCenter.address.name}}
                <ng-container *ngIf="jobCenter.address.street || jobCenter.address.houseNumber">
                  , {{jobCenter.address.street}} {{jobCenter.address.houseNumber}}
                </ng-container>
                <br>
                {{jobCenter.address.zipCode}} {{jobCenter.address.city}}
                <br>
                {{'job-detail.reference.phone' | translate}}
                <a href="tel:{{jobCenter.phone}}">{{jobCenter.phone | jr2PhoneNumber}}</a>
              </address>

              <ng-container *ngIf="job.stellennummerAvam || job.stellennummerEgov">
                <strong>{{'job-detail.reference.job-id' | translate}}:</strong>
                <br>

                <ng-container *ngIf="job.stellennummerAvam">
                  AVAM: {{job.stellennummerAvam}} <br>
                </ng-container>

                <ng-container *ngIf="job.stellennummerEgov">
                  Job-Room: {{job.stellennummerEgov}}
                </ng-container>
              </ng-container>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-------------Main screen-->
    <div class="col-12 col-md-8 order-3 base__content"
         *ngIf="jobDescription$ | async as jobDescription">
      <!-----------------Alerts-->
      <ngb-alert *ngIf="showJobAdExternalMessage"
                 type="info"
                 (close)="showJobAdExternalMessage = false"
                 class="d-print-none">
        {{'job-detail.external-job-disclaimer' | translate}}
      </ngb-alert>
      <ngb-alert type="warning"
                 *ngIf="showJobAdDeactivatedMessage"
                 (close)="showJobAdDeactivatedMessage = false">
        {{'job-detail.deactivated' | translate}}
      </ngb-alert>
      <ngb-alert type="info"
                 *ngIf="showJobAdUnvalidatedMessage"
                 (close)="showJobAdUnvalidatedMessage = false"
                 class="d-print-none">
        {{'job-detail.unvalidated' | translate}}
      </ngb-alert>
      <!-----------------Title-->

      <div class="detail__title">
        <h2 class="text--light mt-2"
            [innerHTML]="jobDescription.title | safeHtml"></h2>
        <span class="text--primary-color"
              *ngIf="job.jobContent.company; else ravLabel">{{job.jobContent.company.name}}</span>
        <ng-template #ravLabel>
          <span class="text--primary-color">{{ 'jobroomApp.job.rav' | translate }}</span>
        </ng-template>
        <small class="detail__date"
               *ngIf="job.publication.startDate">
          {{'job-detail.onlineSince' | translate}}
          : {{ job.publication.startDate | localeAwareDate }}
        </small>
        <small class="detail__date"
               *ngIf="job.jobContent.numberOfJobs">
          {{'jobroomApp.job.numberOfJobs' | translate}}: {{ job.jobContent.numberOfJobs }}
        </small>
      </div>
      <!--Badges-->
      <div class="detail__content">
        <span class="badge badge-job-workplace mr-1">
          <alv-job-location [location]="job.jobContent.location"></alv-job-location>
        </span>

        <span class="badge badge-workload mr-1">{{[job.jobContent.employment.workloadPercentageMin, job.jobContent.employment.workloadPercentageMax] | workingTimeRange}}</span>

        <span *ngIf="job.jobContent.employment.startDate"
              class="badge badge-availability mr-1"
              translate="job-detail.startDate"
              [translateParams]="{date: job.jobContent.employment.startDate | localeAwareDate}"></span>
        <span *ngIf="!job.jobContent.employment.startDate && job.jobContent.employment.immediately != null"
              class="badge badge-availability mr-1">
                    {{'job-detail.startsImmediately.' + job.jobContent.employment.immediately | translate}}
                </span>
        <span *ngIf="job.jobContent.employment.permanent"
              class="badge badge-contract-type mr-1">
                    {{'job-search.job-search-list-item.badge.permanent' | translate}}
          </span>
        <span *ngIf="!job.jobContent.employment.permanent && !!job.jobContent.employment.endDate && !job.jobContent.employment.shortEmployment"
              class="badge badge-availability mr-1"
              translate="job-detail.endDate"
              [translateParams]="{date: job.jobContent.employment.endDate | localeAwareDate}"></span>
        <span *ngIf="!job.jobContent.employment.permanent && !!job.jobContent.employment.shortEmployment"
              class="badge badge-availability mr-1">{{'job-search.job-search-list-item.badge.shortEmployment' | translate}}
                </span>
        <span *ngIf="!job.jobContent.employment.permanent && !job.jobContent.employment.endDate"
              class="badge badge-availability mr-1">{{'job-search.job-search-list-item.badge.temporary' | translate}}</span>
        <span *ngIf="job.reportingObligation"
              class="badge badge-danger">{{'job-search.job-search-list-item.badge.restricted' | translate}}</span>
      </div>
      <!-----------------Description-->

      <div *ngIf="jobDescription.description"
           class="detail__content">
        <markdown [data]="jobDescription.description"
                  ngPreserveWhitespaces></markdown>
      </div>

      <!-----------------Bottom details about job-->

      <ngb-accordion>

        <ngb-panel>
          <ng-template ngbPanelTitle>
            <span class="alv-panel-title">{{ 'job-publication-details.jobad-info.label' | translate }}</span>
          </ng-template>
          <ng-template ngbPanelContent>
            <ul>
              <li>{{'job-detail.workplace.label'|translate}}
                <alv-job-location [location]="job.jobContent.location">
                </alv-job-location>
              </li>
              <li>
                {{'job-detail.employmentStartDate.label'|translate}}
                <span
                  [translateParams]="{date: job.jobContent.employment.startDate | localeAwareDate}"
                  translate="job-detail.startDate">
                </span>
                <span *ngIf="!job.jobContent.employment.startDate && job.jobContent.employment.immediately != null">
                    {{'job-detail.startsImmediately.' + job.jobContent.employment.immediately | translate}}
                </span>
              </li>
              <li>
                {{'job-detail.workload.label'|translate}}
                {{[job.jobContent.employment.workloadPercentageMin, job.jobContent.employment.workloadPercentageMax] | workingTimeRange}}
              </li>
              <li>
                {{'job-detail.employmentEndDate.label'|translate}}
                <span *ngIf="!job.jobContent.employment.permanent && !job.jobContent.employment.endDate">
              {{'job-search.job-search-list-item.badge.temporary' | translate}}
                </span>
                <span *ngIf="job.reportingObligation">
                  {{'job-search.job-search-list-item.badge.restricted' | translate}}
                </span>
              </li>
              <li>
                {{'job-detail.workForm.label'|translate}}
                <span *ngIf="!job.jobContent.employment.permanent && !!job.jobContent.employment.shortEmployment">
                  {{'job-search.job-search-list-item.badge.shortEmployment' | translate}}
                </span>
              </li>
            </ul>
          </ng-template>
        </ngb-panel>
        <ngb-panel>
          <ng-template ngbPanelTitle>
            <span class="alv-panel-title">{{ 'job-publication-details.min-requirements.label' | translate }}</span>
          </ng-template>
          <ng-template ngbPanelContent>
            <ul>
              <li>{{'job-detail.occupation' | translate}}
                : {{(occupation$ | async)?.default}}
              </li>
              <li>{{'job-detail.workExperience' | translate}}
                : {{'global.experience.' + job?.jobContent?.occupations[0]?.workExperience | translate}}</li>
              <li>{{'job-detail.education' | translate}}
                : {{'global.degree.' + job?.jobContent?.occupations[0]?.educationCode| translate}}
              </li>
            </ul>
          </ng-template>
        </ngb-panel>
        <ngb-panel
          *ngIf="job.jobContent?.languageSkills && job.jobContent?.languageSkills?.length > 0">
          <ng-template ngbPanelTitle>
            <span class="alv-panel-title">{{ 'global.reference.languages' | translate }}</span>
          </ng-template>
          <ng-template ngbPanelContent>
            <alv-languages [languages]="job.jobContent.languageSkills"
            ></alv-languages>
          </ng-template>
        </ngb-panel>
        <ngb-panel *ngIf="job.jobContent.applyChannel as applyChannel">
          <ng-template ngbPanelTitle>
            <span class="alv-panel-title">{{ 'job-publication-details.contact-details.label' | translate }}</span>
          </ng-template>
          <ng-template ngbPanelContent>
            <ul>
              <li *ngIf="applyChannel.formUrl as formUrl"
                  class="content__item content__item--bullet">
                <strong>{{ 'job-detail.application.online' | translate }}</strong>
                <span>
                  <a href="{{formUrl}}">
                    {{ 'job-publication-details.application.online-form' | translate}}
                  </a>
                </span>
              </li>
              <li *ngIf="applyChannel.emailAddress as emailAddress"
                  class="content__item content__item--bullet">
                <strong>{{ 'job-detail.application.email' | translate }}</strong>
                <span>
                    <a href="mailto:{{emailAddress}}">{{emailAddress}}</a>
                </span>
              </li>
              <li *ngIf="applyChannel.phoneNumber as phoneNumber"
                  class="content__item content__item--bullet">
                <strong>{{ 'job-detail.application.phone' | translate }}</strong>
                <span>
                  <a href="tel:{{phoneNumber}}">
                        {{(phoneNumber) | jr2PhoneNumber}}
                  </a>
                </span>
              </li>
              <li *ngIf="applyChannel.postAddress || applyChannel.rawPostAddress"
                  class="content__item content__item--bullet">
                <strong>{{ 'job-detail.application.mail' | translate }}</strong>
                <span>
                  <alv-apply-channel-post-address [applyChannel]="applyChannel"></alv-apply-channel-post-address>
                </span>
              </li>
            </ul>
          </ng-template>
        </ngb-panel>
      </ngb-accordion>

    </div>

    <!-------------Right panel-->
    <div class="col-12 col-md order-12 base__related">
      <div class="base__sticky-panel">
        <div class="d-flex justify-content-between">
          <button (click)="prev()"
                  *ngIf="prevVisible$ | async"
                  class="btn btn-text col">
            <i class="fa fa-caret-left pr-1"></i>
            {{'job-detail.previous-result' | translate}}
          </button>
          <button (click)="next()"
                  *ngIf="nextVisible$ | async"
                  class="btn btn-text col">
            {{'job-detail.next-result' | translate}}
            <i class="fa fa-caret-right pl-1"></i>
          </button>
        </div>

        <p>
          <a *ngIf="job.jobContent.applyChannel?.formUrl"
             class="btn btn-primary btn-block btn-sm"
             href="{{job.jobContent.applyChannel?.formUrl}}"
             target="{{job.id}}">
            {{'job-detail.action.applyNow' | translate}}
          </a>
          <a *ngIf="job.jobContent.externalUrl"
             class="btn btn-secondary btn-block btn-sm"
             href="{{job.jobContent.externalUrl}}"
             target="{{job.id}}">
            {{'job-detail.action.showExternalPage' | translate}}
          </a>
        </p>

        <ul class="nav filter-nav flex-column">
          <li class="nav-item">
            <a class="btn btn-text"
               #copyToClipboard
               ngxClipboard
               [cbContent]="getJobUrl()"
               (cbOnSuccess)="onCopyLink()"
               [ngbTooltip]="'global.messages.tooltip.link-copy.success' | translate"
               triggers="manual">
              <i aria-hidden="true"
                 class="fa fa-copy mr-1"></i>
              <span>{{'job-detail.action.copyLink' | translate}}</span>
            </a>
          </li>
          <li>
            <a class="btn btn-text"
               href="{{'mailto:?body=' + getEncodedUrl()}}">
              <i aria-hidden="true"
                 class="fa fa-at mr-1"></i>
              <span>{{'job-detail.action.sendEmail' | translate}}</span>
            </a>
          </li>
          <li class="nav-item d-none d-md-block">
            <a class="btn btn-text"
               (click)="printJob()">
              <i aria-hidden="true"
                 class="fa fa-print mr-1"></i>
              <span>{{'job-detail.action.print' | translate}}</span>
            </a>
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>



